<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Planets</title>
    <style>
    canvas {
      border: 1px solid black;
    }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/seedrandom/2.4.0/seedrandom.min.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>


    <!-- Latest compiled JavaScript -->
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script>
    var interval = null;
    $(document).ready(function(){
      $("#start").click(function(){
        start();
      });
      var start = function(){
        clearInterval(interval);
        Math.seedrandom("spam");
        var planets = [];
        for (i = 0; i < num_planets; i ++) {
          planets.push(new Planet(Math.random()*18, Math.random()*width*.75 + width*.125, Math.random()*height*.75 + height*.125, Math.random()*start_vel - start_vel/2, Math.random()*start_vel - start_vel/2, 0, 0));
        };
        var world = new Universe(planets);

        interval = setInterval(function(){
          ctx.clearRect(0, 0, width, height);
          ctx.fillStyle = "black";
          ctx.fillRect(0, 0, width, height);
          ctx.fill();
          world.run();
          //world.run();

        }, 1);
      };
      $(function() {
        $( "#slider" ).slider();
      });

    });
    </script>
  </head>
  <body>
    <canvas id="screen" width = "10" height = "10"></canvas>
    <a href="index.html">Back to my Github</a>

    <script>
    var height = window.innerHeight*.8;
    var width = window.innerWidth*.8;

//    $(document).ready(function(){


      $("canvas").attr("width", width);
      $("canvas").attr("height", height);

      var canv = document.getElementById('screen');
      var ctx = canv.getContext('2d');
      ctx.fillStyle = "black";
      ctx.fillRect(0,0, width, height);

      var mass_to_radius =  .1;



      function Universe(planets){
        this.planets = planets;

        this.get_distance = function(planet1, planet2){
          var x_dist = Math.abs(planet1.x - planet2.x);
          var y_dist = Math.abs(planet1.y - planet2.y);
          var dist = Math.sqrt(Math.pow(x_dist, 2) + Math.pow(y_dist, 2));
          return dist;
        };

        this.merge_planets = function(id1, id2) {
          p1 = this.planets[id1];
          p2 = this.planets[id2];
          if (p1.mass < p2.mass){
            p1 = this.planets[id2];
            p2 = this.planets[id1];
          };
          p1.x_vel = (p1.x_vel*p1.mass + p2.x_vel*p2.mass)/(colision_dampening*(p1.mass + p2.mass));
          p1.y_vel = (p1.y_vel*p1.mass + p2.y_vel*p2.mass)/(colision_dampening*(p1.mass + p2.mass));
          p1.mass += p2.mass;
          if (this.planets[id1].mass < this.planets[id2].mass){
            this.planets.splice(id1, 1);
          } else {
            this.planets.splice(id2, 1);
          };
        };

        this.update_gravity = function(){
          for (i = 0; i < this.planets.length -1; i++){
            for (j = i + 1; j < this.planets.length; j++){
              if (j === i) {
                continue
              } else {
                p1 = this.planets[i];
                p2 = this.planets[j];
                distance = this.get_distance(p1, p2);
                if (distance < Math.sqrt(p1.mass) + Math.sqrt(p2.mass)){
                  this.merge_planets(i, j);
                } else {
                  x_fraction = Math.abs(p1.x - p2.x)/(Math.abs(p1.x - p2.x) + Math.abs(p1.y - p2.y));
                  y_fraction = 1 - x_fraction;
                  force = GRAVITY*p1.mass*p2.mass/Math.pow(distance, 2);
                  p1.x_accel += Math.sign(p2.x - p1.x)*force*x_fraction/p1.mass;
                  p2.x_accel += Math.sign(p1.x - p2.x)*force*x_fraction/p2.mass;
                  p1.y_accel += Math.sign(p2.y - p1.y)*force*y_fraction/p1.mass;
                  p2.y_accel += Math.sign(p1.y - p2.y)*force*y_fraction/p2.mass;
                };
              };
            };
          };
        };

        this.run = function(){
          this.update_gravity();
          for (i = 0; i < this.planets.length; i++){
            this.planets[i].run();
          };
        };
      };


      function Planet(mass, x, y, x_vel, y_vel, x_accel, y_accel){
        this.mass = mass;
        this.x = x;
        this.y = y;
        this.x_vel = x_vel;
        this.y_vel = y_vel;
        this.x_accel = x_accel;
        this.y_accel = y_accel;

        this.move = function(){
          this.x += this.x_vel;
          this.y += this.y_vel;
          this.x_vel += this.x_accel;
          this.y_vel += this.y_accel;
          this.x_accel = 0;
          this.y_accel = 0;
        };

        this.render = function(){
          ctx.fillStyle = "gray";
          ctx.beginPath();
          ctx.arc(this.x, this.y, Math.sqrt(this.mass), 0, 2*Math.PI);
          ctx.fill();
        };

        this.run = function(){
          this.move();
          this.render();
        };
      };

      var GRAVITY = .01;
      var num_planets = 590;
      var start_vel = .6;
      var colision_dampening = 1.01;



    //});
    </script>
    <br>
    <button id="start">Restart</button>
    <div class="container">
      <div id="slider"></div>
    </div>
  </body>
</html>
